**Erros de autoriza√ß√£o:**
- **Acesso negado**: Role insuficiente
- **Recurso protegido**: Tentativa de acesso n√£o autorizado
- **Token inv√°lido**: Sess√£o comprometida
- **Permiss√£o revogada**: Altera√ß√£o de role# BetLink - Sistema de Autentica√ß√£o e Permiss√µes

## 1. Vis√£o Geral do Sistema

### 1.1 Arquitetura de Autentica√ß√£o
**Stack Tecnol√≥gico:**
- **Supabase Auth**: Sistema principal de autentica√ß√£o e gerenciamento de usu√°rios
- **NextJS Middleware**: Verifica√ß√£o de rotas protegidas no lado do servidor
- **RLS (Row Level Security)**: Controle de acesso a dados no n√≠vel de banco
- **JWT Tokens**: Sess√µes seguras e autoriza√ß√£o stateless

### 1.2 N√≠veis de Permiss√£o
**Hierarquia de usu√°rios:**
1. **Master**: Controle total da plataforma (dono do sistema)
2. **Admin**: Gerenciamento de tipsters e clientes
3. **Tipster**: Gest√£o de canais pr√≥prios e assinantes
4. **Cliente**: Acesso a assinaturas e dashboard pessoal

### 1.3 Fluxos de Autentica√ß√£o
- **Cliente**: Sign-up p√∫blico + confirma√ß√£o por email + login
- **Tipster**: Criado por Admin + email com credenciais + troca obrigat√≥ria de senha
- **Admin**: Criado por Master + credenciais diretas
- **Master**: Configura√ß√£o inicial da plataforma (seed data)

---

## 2. Configura√ß√£o do Supabase

### 2.1 Setup do Projeto
## üéØ MVP - MUST HAVE

**Configura√ß√£o B√°sica:**
- **Projeto Supabase**: Configura√ß√£o de URL e chaves de API
- **Vari√°veis de ambiente**: URLs p√∫blicas e service role keys
- **Pol√≠ticas RLS**: Habilita√ß√£o de Row Level Security
- **Configura√ß√£o de email**: SMTP para envio de confirma√ß√µes

### 2.2 Schema de Dados
**Tabela auth.users (Supabase nativo):**
- **Gerenciamento autom√°tico**: Email, senha hash, timestamps
- **Metadata**: Informa√ß√µes customizadas do usu√°rio
- **Confirma√ß√£o**: Sistema de verifica√ß√£o por email

**Tabela public.profiles (Customizada):**
- **Extens√£o de usu√°rio**: Dados adicionais de perfil
- **Role management**: Tipo de usu√°rio (master/admin/tipster/cliente)
- **Relacionamento**: Foreign key com auth.users
- **Campos customizados**: 
  - Nome completo
  - Avatar
  - Telefone (obrigat√≥rio para clientes e tipsters)
  - Telegram username (obrigat√≥rio para clientes e tipsters)
  - Configura√ß√µes espec√≠ficas por role

### 2.3 Row Level Security (RLS)
## üéØ MVP - MUST HAVE

**Pol√≠ticas de Seguran√ßa:**
- **Usu√°rios**: Podem ver e editar apenas pr√≥prio perfil
- **Admins**: Podem criar e gerenciar perfis de tipsters
- **Masters**: Acesso total a todos os dados
- **Isolamento**: Tipsters veem apenas seus canais e clientes

---

## 3. Processo de Autentica√ß√£o por Tipo de Usu√°rio

### 3.1 Cliente (Sign-up P√∫blico)
## üéØ MVP - MUST HAVE

#### P√°gina de Cadastro
**Campos obrigat√≥rios:**
- **Nome completo**: Valida√ß√£o de m√≠nimo 2 caracteres
- **Email**: Valida√ß√£o de formato + unicidade
- **Telefone**: Formato nacional (11) 99999-9999
- **@ do Telegram**: Username sem @ (ex: joaosilva)
- **Senha**: Crit√©rios de seguran√ßa obrigat√≥rios
- **Confirmar senha**: Match validation
- **Termos de uso**: Aceite obrigat√≥rio

**Valida√ß√µes espec√≠ficas:**
- **Email √∫nico**: Verifica√ß√£o no banco de dados
- **Telefone**: Formato brasileiro + valida√ß√£o de operadora
- **Telegram**: Username v√°lido + verifica√ß√£o se existe
- **Senha forte**: M√≠nimo 8 caracteres + mai√∫scula + n√∫mero
- **Rate limiting**: Prote√ß√£o contra cadastros em massa

#### Confirma√ß√£o de Email
**Fluxo autom√°tico:**
1. **Cadastro** ‚Üí Email de confirma√ß√£o enviado
2. **Cliente** clica no link √∫nico
3. **Conta** √© ativada automaticamente
4. **Perfil** √© criado na tabela profiles
5. **Redirecionamento** para dashboard

### 3.2 Cliente (Login)
## üéØ MVP - MUST HAVE

#### P√°gina de Login
**Funcionalidades:**
- **Email/senha**: Autentica√ß√£o padr√£o
- **Lembrar-me**: Sess√£o persistente opcional
- **Esqueci senha**: Link para recupera√ß√£o
- **Redirecionamento inteligente**: Baseado no tipo de usu√°rio

#### Recupera√ß√£o de Senha
**Processo seguro:**
- **Solicita√ß√£o**: Por email registrado
- **Email √∫nico**: Link com token tempor√°rio
- **Nova senha**: P√°gina segura para redefini√ß√£o
- **Confirma√ß√£o**: Login autom√°tico ap√≥s altera√ß√£o

### 3.3 Tipster (Cria√ß√£o por Admin)
## üéØ MVP - MUST HAVE

#### Processo de Cria√ß√£o
**Fluxo administrativo:**
1. **Admin** acessa painel de usu√°rios
2. **Preenche** dados b√°sicos do tipster:
   - Nome completo
   - Email (√∫nico)
   - Telefone (formato brasileiro)
   - @ do Telegram (username)
3. **Sistema** gera senha tempor√°ria
4. **Email** autom√°tico com credenciais
5. **Tipster** obrigado a trocar senha no primeiro login

#### Email de Credenciais
**Conte√∫do autom√°tico:**
- **Dados de acesso**: Email e senha tempor√°ria
- **Dados pessoais**: Nome e telefone cadastrados
- **Telegram**: Username configurado para os canais
- **Link direto**: Para √°rea de login do tipster
- **Instru√ß√µes**: Como fazer primeiro acesso
- **Aviso**: Necessidade de trocar senha

### 3.4 Tipster (Primeiro Login)
## üéØ MVP - MUST HAVE

#### Login Separado
**√Årea espec√≠fica:**
- **URL dedicada**: /tipster/login (separada da √°rea p√∫blica)
- **Interface diferenciada**: Visual espec√≠fico para tipsters
- **Valida√ß√£o**: Apenas usu√°rios com role "tipster"

#### Troca Obrigat√≥ria de Senha
**Processo for√ßado:**
1. **Login** com credenciais recebidas
2. **Detec√ß√£o** de primeira entrada
3. **Redirecionamento** obrigat√≥rio para troca de senha
4. **Valida√ß√£o**: Nova senha deve atender crit√©rios
5. **Conclus√£o**: Acesso liberado para √°rea do tipster

---

## 4. Prote√ß√£o de Rotas e Middleware

### 4.1 NextJS Middleware
## üéØ MVP - MUST HAVE

**Verifica√ß√£o autom√°tica:**
- **Intercepta√ß√£o**: Todas as rotas protegidas
- **Valida√ß√£o**: Sess√£o ativa e role adequado
- **Redirecionamento**: Baseado no status de autentica√ß√£o
- **Performance**: Verifica√ß√£o no edge antes do rendering

**Rotas protegidas:**
- **/dashboard/***: Apenas clientes autenticados
- **/meus-canais/***: Apenas tipsters autenticados
- **/admin/***: Apenas admin/master
- **√Årea p√∫blica**: Sem restri√ß√µes

### 4.2 Controle de Permiss√µes
**Valida√ß√£o por role:**
- **Cliente**: Acesso apenas ao pr√≥prio dashboard
- **Tipster**: Acesso apenas aos pr√≥prios canais
- **Admin**: Gerenciamento de tipsters e configura√ß√µes
- **Master**: Acesso completo ao sistema

### 4.3 Redirecionamento Inteligente
**Baseado no tipo de usu√°rio:**
- **Login cliente** ‚Üí /dashboard
- **Login tipster** ‚Üí /meus-canais
- **Login admin** ‚Üí /admin
- **Usu√°rio n√£o autorizado** ‚Üí P√°gina de erro

---

## 5. Gest√£o de Sess√µes e Seguran√ßa

### 5.1 Configura√ß√£o de Sess√£o
## üéØ MVP - MUST HAVE

**Par√¢metros de seguran√ßa:**
- **Dura√ß√£o**: 24 horas para sess√£o ativa
- **Refresh token**: 30 dias para renova√ß√£o autom√°tica
- **Sess√µes concorrentes**: M√°ximo 3 por usu√°rio
- **Timeout**: Logout autom√°tico por inatividade

### 5.2 Renova√ß√£o Autom√°tica
**Processo transparente:**
- **Token refresh**: Autom√°tico antes da expira√ß√£o
- **Sess√£o cont√≠nua**: Sem interrup√ß√£o para o usu√°rio
- **Fallback**: Logout seguro se renova√ß√£o falhar
- **Logging**: Registro de todas as renova√ß√µes

### 5.3 Logout Seguro
**Limpeza completa:**
- **Invalida√ß√£o**: Token no servidor
- **Limpeza local**: Storage e cache do browser
- **Redirecionamento**: Para p√°gina inicial
- **Auditoria**: Log do evento de logout

---

## 6. Valida√ß√µes e Regras de Neg√≥cio

### 6.1 Valida√ß√£o de Dados
## üéØ MVP - MUST HAVE

**Crit√©rios de senha:**
- **Comprimento**: M√≠nimo 8 caracteres
- **Complexidade**: Mai√∫scula + min√∫scula + n√∫mero + especial
- **Hist√≥rico**: N√£o pode ser igual √†s √∫ltimas 3 senhas
- **Dicion√°rio**: Prote√ß√£o contra senhas comuns

**Valida√ß√£o de dados obrigat√≥rios:**
- **Email √∫nico**: Verifica√ß√£o no banco de dados
- **Telefone**: Formato brasileiro (11) 99999-9999
- **Telegram**: Username v√°lido (sem @, 5-32 caracteres)
- **Senha forte**: M√≠nimo 8 caracteres + mai√∫scula + n√∫mero
- **Rate limiting**: Prote√ß√£o contra cadastros em massa

**Valida√ß√£o espec√≠fica do Telegram:**
- **Username**: Apenas letras, n√∫meros e underscore
- **Comprimento**: Entre 5 e 32 caracteres
- **Unicidade**: Verifica√ß√£o se j√° est√° em uso no sistema
- **Exist√™ncia**: Valida√ß√£o opcional se username existe no Telegram

### 6.2 Rate Limiting
**Prote√ß√£o contra ataques:**
- **Login**: M√°ximo 5 tentativas por 15 minutos
- **Cadastro**: M√°ximo 3 por IP por hora
- **Reset senha**: M√°ximo 3 tentativas por hora
- **Bloqueio progressivo**: Aumento do tempo de bloqueio

### 6.3 Auditoria e Logs
**Monitoramento de seguran√ßa:**
- **Eventos**: Login, logout, altera√ß√µes de senha
- **Metadados**: IP, user-agent, timestamp
- **Tentativas**: Logs de falhas e sucessos
- **Reten√ß√£o**: Dados por 90 dias

---

## 7. Integra√ß√£o com Sistema

### 7.1 Integra√ß√£o com Telegram
**Dados necess√°rios para funcionamento:**
- **Username**: @ do Telegram para adicionar aos canais
- **Verifica√ß√£o**: Valida√ß√£o se username existe
- **Unicidade**: N√£o permitir usernames duplicados
- **Formato**: Sem @ inicial, apenas alphanumerico e underscore

**Processo de valida√ß√£o:**
- **Cliente/Tipster**: Informa username no cadastro
- **Sistema**: Valida formato e unicidade
- **Bot**: Usa username para gerenciar canais
- **Atualiza√ß√£o**: Permite altera√ß√£o posterior nas configura√ß√µes

### 7.2 Context Provider
**Estado global de autentica√ß√£o:**
- **User state**: Informa√ß√µes do usu√°rio logado
- **Loading states**: Status de carregamento
- **Error handling**: Tratamento de erros de auth
- **Session management**: Controle de sess√£o ativa

### 7.3 Hooks Customizados
**Facilitadores de desenvolvimento:**
- **useAuth**: Hook principal de autentica√ß√£o
- **useRequireAuth**: Hook para p√°ginas protegidas
- **useRole**: Hook para verifica√ß√£o de permiss√µes
- **useProfile**: Hook para dados do perfil

### 7.4 Componentes Reutiliz√°veis
**Building blocks:**
- **ProtectedRoute**: Wrapper para rotas protegidas
- **AuthGuard**: Verifica√ß√£o de permiss√µes
- **LoginForm**: Formul√°rio padronizado
- **AuthLoading**: Estado de carregamento

## 8. Tratamento de Erros

### 8.1 Categorias de Erro
## üéØ MVP - MUST HAVE

**Erros de autentica√ß√£o:**
- **Credenciais inv√°lidas**: Email/senha incorretos
- **Email n√£o confirmado**: Conta n√£o verificada
- **Conta bloqueada**: Muitas tentativas de login
- **Sess√£o expirada**: Token inv√°lido ou expirado

**Erros de valida√ß√£o espec√≠ficos:**
- **Telefone inv√°lido**: Formato n√£o aceito
- **Telegram inv√°lido**: Username n√£o conforme
- **Telegram duplicado**: Username j√° cadastrado
- **Telegram inexistente**: Username n√£o existe no Telegram

### 8.2 Mensagens de Erro
**Comunica√ß√£o clara:**
- **Tradu√ß√£o**: Mensagens em portugu√™s
- **Contexto**: Explica√ß√£o do problema
- **A√ß√£o**: Pr√≥ximos passos para o usu√°rio
- **Suporte**: Como obter ajuda se necess√°rio

### 8.3 Estados de Loading
**Feedback visual:**
- **Skeleton screens**: Para carregamento de dados
- **Spinners**: Para opera√ß√µes r√°pidas
- **Progress bars**: Para processos longos
- **Disabled states**: Para preven√ß√£o de double-click

---

## 9. Configura√ß√µes de Produ√ß√£o

### 9.1 Seguran√ßa em Produ√ß√£o
**Hardening de seguran√ßa:**
- **HTTPS obrigat√≥rio**: SSL/TLS em todas as conex√µes
- **Cookies seguros**: Flags httpOnly e secure
- **Headers de seguran√ßa**: CSP, HSTS, X-Frame-Options
- **Rate limiting ativo**: Prote√ß√£o DDoS b√°sica

### 9.2 Monitoramento
**Observabilidade:**
- **M√©tricas de auth**: Taxa de sucesso, falhas, tempo resposta
- **Alertas**: Tentativas de acesso suspeitas
- **Dashboard**: Vis√£o geral da sa√∫de do sistema
- **Logs estruturados**: Para an√°lise e debugging

### 9.3 Backup e Recupera√ß√£o
**Continuidade do neg√≥cio:**
- **Backup de usu√°rios**: Dados cr√≠ticos preservados
- **Procedimentos**: Recupera√ß√£o de contas perdidas
- **Rollback**: Capacidade de reverter altera√ß√µes
- **Disaster recovery**: Plano para falhas cr√≠ticas

---

## 10. Roadmap de Funcionalidades

### 10.1 MVP (Must Have)
- ‚úÖ Cadastro e login de clientes
- ‚úÖ Cria√ß√£o de tipsters por admin
- ‚úÖ Prote√ß√£o de rotas por role
- ‚úÖ Recupera√ß√£o de senha
- ‚úÖ Confirma√ß√£o de email
- ‚úÖ Sess√µes seguras

### 10.2 v1.1 (Nice to Have)
- üîê Autentica√ß√£o em dois fatores (2FA)
- üë• Login social (Google, Facebook)
- üì± Notifica√ß√µes push para login
- üîí Bloqueio autom√°tico de contas suspeitas
- üìä Dashboard de analytics de auth

### 10.3 v2.0 (Future)
- üåç Single Sign-On (SSO)
- üéØ Autentica√ß√£o biom√©trica
- üîó Integra√ß√£o com sistemas externos
- ü§ñ ML para detec√ß√£o de fraudes
- üìã Compliance LGPD/GDPR completo

---

## 11. Considera√ß√µes de UX

### 11.1 Experi√™ncia do Usu√°rio
**Fluidez na autentica√ß√£o:**
- **Onboarding suave**: Cadastro em etapas simples
- **Feedback imediato**: Valida√ß√£o em tempo real
- **Recovery f√°cil**: Processo intuitivo de recupera√ß√£o
- **Lembran√ßa inteligente**: Auto-complete e sugest√µes

### 11.2 Acessibilidade
**Inclus√£o digital:**
- **Compatibilidade**: Screen readers e teclado
- **Contraste**: Conformidade WCAG 2.1 AA
- **Tamanhos**: Bot√µes e campos adequados
- **Linguagem**: Clara e objetiva

### 11.3 Performance
**Velocidade e responsividade:**
- **Load time**: P√°ginas de auth em < 2s
- **Feedback**: Estados de loading claros
- **Offline**: Degrada√ß√£o graciosa sem conex√£o
- **Cache**: Otimiza√ß√£o de recursos est√°ticos