# BetLink - Workflow Detalhado por Feature

## ğŸ“‹ VisÃ£o Geral

Cada feature Ã© uma evoluÃ§Ã£o incremental e testÃ¡vel do aplicativo. Este workflow garante que cada implementaÃ§Ã£o seja isolada, testÃ¡vel e nÃ£o quebre funcionalidades existentes.

---

## ğŸ”„ As 6 Etapas do Workflow

### **1ï¸âƒ£ PLANEJAMENTO** ğŸ“‹

#### Objetivo
Criar um contrato claro e especÃ­fico do que serÃ¡ construÃ­do, com teste humano bem definido.

#### Template de Planejamento

```markdown
# Feature: [Nome da Feature]

## 1. Teste Humano
**O que testar**: [DescriÃ§Ã£o clara do que o usuÃ¡rio deve conseguir fazer]
**Como testar**:
1. [Passo 1]
2. [Passo 2]
3. [Passo 3]

**Resultado esperado**: [DescriÃ§Ã£o ou screenshot do resultado final]

## 2. DependÃªncias
- **Features anteriores**: [Lista de features que devem estar funcionando]
- **Arquivos existentes**: 
  - `/path/to/file1.ts`
  - `/path/to/file2.tsx`
- **Bibliotecas necessÃ¡rias**: 
  - `@supabase/supabase-js`
  - `react-hook-form`

## 3. Guardrails
### NÃƒO MODIFICAR
- `/app/layout.tsx` - Layout principal
- `/lib/supabase/client.ts` - ConfiguraÃ§Ã£o base
- [Outros arquivos crÃ­ticos]

### DEVE MANTER
- NavegaÃ§Ã£o existente funcionando
- AutenticaÃ§Ã£o (se jÃ¡ implementada)
- [Outros comportamentos]

### PODE CRIAR
- `/app/[nova-rota]/page.tsx`
- `/components/features/[feature]/`
- [Outros arquivos permitidos]

### DEVE REUTILIZAR
- Componente `Button` de `/components/ui/`
- Hook `useAuth` de `/hooks/`
- [Outros recursos existentes]

## 4. Contexto TÃ©cnico
### Quais Documentos devo usar de contexto?


### Schema do Banco (apenas relevante)
```sql
-- Apenas tabelas necessÃ¡rias para esta feature
CREATE TABLE profiles (
  id UUID PRIMARY KEY,
  ...
);
```

### APIs/FunÃ§Ãµes DisponÃ­veis
```typescript
// Exemplo de funÃ§Ã£o disponÃ­vel
async function getUser(id: string) { ... }
```

### PadrÃµes do Projeto
- Nomenclatura: PascalCase para componentes
- Imports: Ordem especÃ­fica (ver guia)
- [Outros padrÃµes]

## 5. Estimativa
- **Complexidade**: Baixa/MÃ©dia/Alta
- **Tempo estimado**: X horas
- **Riscos identificados**: [Lista]
```

---

### **2ï¸âƒ£ EXECUÃ‡ÃƒO** ğŸš€

#### EstratÃ©gias para ImplementaÃ§Ã£o

##### A. Sistema de Logs Estruturados
```typescript
// PadrÃ£o de logs para rastreabilidade
const FEATURE_NAME = '[Feature: NomeDaFeature]';

console.log(`${FEATURE_NAME} Iniciando processo...`);
console.error(`${FEATURE_NAME} Erro encontrado:`, error);
console.warn(`${FEATURE_NAME} AtenÃ§Ã£o:`, warning);

// Em componentes React
useEffect(() => {
  console.log(`${FEATURE_NAME} Componente montado`);
  return () => console.log(`${FEATURE_NAME} Componente desmontado`);
}, []);
```

##### B. ComentÃ¡rios de Guardrail
```typescript
/**
 * @feature: Login
 * @guardrail: Este arquivo Ã© base - NÃƒO MODIFICAR
 * @dependencies: supabase, react-hook-form
 * @created: Feature 1
 */

// No topo de arquivos crÃ­ticos
// @protected: NÃ£o modificar sem aprovaÃ§Ã£o
```

##### C. Error Boundaries por Feature
```typescript
// components/features/[feature]/error-boundary.tsx
export function FeatureErrorBoundary({ 
  children, 
  feature 
}: { 
  children: React.ReactNode;
  feature: string;
}) {
  return (
    <ErrorBoundary
      fallback={<div>Erro na feature: {feature}</div>}
      onError={(error) => {
        console.error(`[Feature: ${feature}] Erro capturado:`, error);
      }}
    >
      {children}
    </ErrorBoundary>
  );
}
```

##### D. Feature Flags
```typescript
// config/feature-flags.ts
export const FEATURES = {
  AUTH: true,           // âœ… Implementado
  CANAIS_LIST: true,    // âœ… Implementado
  PAYMENT: false,       // ğŸš§ Em desenvolvimento
  TELEGRAM_BOT: false,  // â³ Planejado
} as const;

// Uso no cÃ³digo
if (FEATURES.PAYMENT) {
  return <PaymentComponent />;
}
return <ComingSoon feature="Pagamentos" />;
```

---

### **3ï¸âƒ£ TESTE IA** ğŸ¤–

#### Template de Teste Playwright

```typescript
// tests/features/[nome-feature].spec.ts
import { test, expect } from '@playwright/test';

const FEATURE_NAME = 'Nome da Feature';

test.describe(`Feature: ${FEATURE_NAME}`, () => {
  // Setup antes de todos os testes
  test.beforeEach(async ({ page }) => {
    console.log(`[Test: ${FEATURE_NAME}] Iniciando teste`);
    await page.goto('/');
  });

  test('Teste principal: [descriÃ§Ã£o do que deve funcionar]', async ({ page }) => {
    // Arrange - Preparar
    await page.waitForLoadState('networkidle');
    
    // Act - Agir
    await page.click('[data-testid="botao-principal"]');
    
    // Assert - Verificar
    await expect(page.locator('[data-testid="resultado"]')).toBeVisible();
    
    // Log de sucesso
    console.log(`âœ… ${FEATURE_NAME}: Teste principal passou`);
  });

  test('NÃ£o deve quebrar features anteriores', async ({ page }) => {
    // Verificar que navegaÃ§Ã£o ainda funciona
    await expect(page.locator('nav')).toBeVisible();
    
    // Verificar que outras rotas ainda carregam
    await page.goto('/dashboard');
    await expect(page).not.toHaveURL('/404');
    
    console.log(`âœ… ${FEATURE_NAME}: Features anteriores OK`);
  });

  // Teste de erro
  test('Deve mostrar erro apropriado quando falhar', async ({ page }) => {
    // Simular erro
    await page.route('**/api/**', route => route.abort());
    
    // Verificar tratamento
    await page.click('[data-testid="acao-que-falha"]');
    await expect(page.locator('.error-message')).toBeVisible();
    
    console.log(`âœ… ${FEATURE_NAME}: Tratamento de erro OK`);
  });
});
```

#### Script de Auto-correÃ§Ã£o

```typescript
// scripts/test-and-fix.ts
async function testAndFix() {
  console.log('ğŸ¤– Executando testes automatizados...');
  
  const result = await runTests();
  
  if (!result.success) {
    console.log('âŒ Erros encontrados. Tentando corrigir...');
    
    for (const error of result.errors) {
      if (error.type === 'MISSING_IMPORT') {
        await fixMissingImport(error);
      } else if (error.type === 'TYPE_ERROR') {
        await fixTypeError(error);
      }
      // ... outras correÃ§Ãµes automÃ¡ticas
    }
    
    // Testar novamente
    const retryResult = await runTests();
    if (retryResult.success) {
      console.log('âœ… Erros corrigidos automaticamente!');
    } else {
      console.log('âš ï¸ Alguns erros precisam de intervenÃ§Ã£o manual');
    }
  }
}
```

---

### **4ï¸âƒ£ TESTE HUMANO** ğŸ‘¤

#### Checklist de ValidaÃ§Ã£o

```markdown
## Checklist de Teste Manual - Feature: [Nome]

### Funcionalidade Principal
- [ ] A feature funciona conforme o teste definido no planejamento?
- [ ] Todos os casos de uso estÃ£o cobertos?
- [ ] A UX estÃ¡ intuitiva e sem bugs visuais?

### RegressÃ£o
- [ ] Features anteriores continuam funcionando?
- [ ] NavegaÃ§Ã£o entre pÃ¡ginas estÃ¡ normal?
- [ ] NÃ£o hÃ¡ erros no console?

### Performance
- [ ] PÃ¡gina carrega em menos de 3 segundos?
- [ ] NÃ£o hÃ¡ re-renders desnecessÃ¡rios?
- [ ] Imagens e assets estÃ£o otimizados?

### Responsividade
- [ ] Desktop (1920x1080) âœ“
- [ ] Laptop (1366x768) âœ“
- [ ] Tablet (768x1024) âœ“
- [ ] Mobile (375x667) âœ“

### Acessibilidade
- [ ] NavegaÃ§Ã£o por teclado funciona?
- [ ] Cores tÃªm contraste adequado?
- [ ] Elementos tÃªm labels apropriados?

### SeguranÃ§a
- [ ] Dados sensÃ­veis nÃ£o aparecem em logs?
- [ ] AutenticaÃ§Ã£o/autorizaÃ§Ã£o funcionando?
- [ ] Inputs estÃ£o validados?

### ObservaÃ§Ãµes
[EspaÃ§o para notas durante o teste]
```

---

### **5ï¸âƒ£ REFINAMENTO** ğŸ”§

#### Processo de Refinamento

```markdown
## Refinamento - Feature: [Nome]

### 1. Problemas Identificados

#### ğŸ”´ CrÃ­ticos (Bloqueiam release)
1. **Problema**: [DescriÃ§Ã£o]
   - **Impacto**: [O que estÃ¡ quebrado]
   - **SoluÃ§Ã£o proposta**: [Como corrigir]
   - **Status**: â³ Pendente / âœ… Resolvido

#### ğŸŸ¡ Importantes (Devem ser corrigidos)
1. **Problema**: [DescriÃ§Ã£o]
   - **Impacto**: [O que afeta]
   - **SoluÃ§Ã£o proposta**: [Como melhorar]
   - **Status**: â³ Pendente / âœ… Resolvido

#### ğŸŸ¢ Nice-to-have (Melhorias futuras)
1. **Melhoria**: [DescriÃ§Ã£o]
   - **BenefÃ­cio**: [Por que fazer]
   - **Complexidade**: Baixa/MÃ©dia/Alta

### 2. Log de CorreÃ§Ãµes
```
[Data/Hora] - Corrigido: [descriÃ§Ã£o] - [arquivo modificado]
[Data/Hora] - Testado: [o que foi verificado] - OK âœ…
```

### 3. DecisÃµes TÃ©cnicas
- **DecisÃ£o**: [O que foi decidido]
  **Motivo**: [Por que essa escolha]
  **Alternativas consideradas**: [Outras opÃ§Ãµes]
```

---

### **6ï¸âƒ£ DOCUMENTAÃ‡ÃƒO** ğŸ“š

#### A. Status Update (`docs/features-status.md`)

```markdown
# Status das Features - BetLink

## âœ… ConcluÃ­das

### Feature 1: Setup Inicial
- **Status**: âœ… Completa
- **Data**: 01/01/2024
- **Teste**: "Hello World" com Tailwind funcionando
- **Aprendizados**: [Link para doc]

### Feature 2: Componentes UI Base
- **Status**: âœ… Completa
- **Data**: 02/01/2024
- **Teste**: Button e Card do shadcn renderizados
- **Aprendizados**: [Link para doc]

## ğŸš§ Em Progresso

### Feature 3: ConexÃ£o Supabase
- **Status**: ğŸš§ 80% - Falta tratamento de erros
- **InÃ­cio**: 03/01/2024
- **Bloqueios**: ConfiguraÃ§Ã£o de RLS

## â³ Planejadas

### Feature 4: Sistema de Login
- **Status**: â³ Aguardando Feature 3
- **Estimativa**: 2 dias
- **DependÃªncias**: Supabase Auth configurado
```

#### B. Documento de Aprendizados (`docs/learnings/feature-[nome].md`)

```markdown
# Aprendizados - Feature: [Nome]

## ğŸ“… InformaÃ§Ãµes
- **Data**: [Data de implementaÃ§Ã£o]
- **DuraÃ§Ã£o**: [Tempo real vs estimado]
- **Desenvolvedor**: [IA + Humano]

## âœ… O que funcionou bem
1. **EstratÃ©gia**: [O que deu certo]
   - **Por quÃª**: [Motivo do sucesso]
   - **Reutilizar em**: [Onde aplicar novamente]

2. **CÃ³digo reutilizado**: 
   - Componente X da Feature Y
   - Hook Z funcionou perfeitamente

## âŒ Problemas encontrados

### Problema 1: [TÃ­tulo]
- **DescriÃ§Ã£o**: [Detalhes do problema]
- **Erro**: `[Mensagem de erro]`
- **Causa raiz**: [Por que aconteceu]
- **SoluÃ§Ã£o**: [Como foi resolvido]
- **PrevenÃ§Ã£o**: [Como evitar no futuro]
- **Tempo perdido**: [Quanto tempo levou]

### Problema 2: [TÃ­tulo]
[...]

## ğŸ’¡ DecisÃµes tÃ©cnicas

### DecisÃ£o 1: [Usar biblioteca X ao invÃ©s de Y]
- **Contexto**: [SituaÃ§Ã£o que levou Ã  decisÃ£o]
- **OpÃ§Ãµes consideradas**:
  - OpÃ§Ã£o A: [PrÃ³s e contras]
  - OpÃ§Ã£o B: [PrÃ³s e contras]
- **Escolha final**: [Qual e por quÃª]
- **Resultado**: [Foi boa decisÃ£o?]

## ğŸ“Š MÃ©tricas
- **Linhas de cÃ³digo**: ~XXX
- **Arquivos criados**: Y
- **Arquivos modificados**: Z
- **Cobertura de testes**: XX%
- **Bugs encontrados**: N
- **Bugs corrigidos**: N

## ğŸ”® RecomendaÃ§Ãµes futuras
1. [SugestÃ£o para prÃ³ximas features]
2. [Melhorias no processo]
3. [Ferramentas que ajudariam]
```

#### C. Documento de Handover (`docs/handover/to-feature-[prÃ³xima].md`)

```markdown
# Handover para Feature: [PrÃ³xima Feature]

## ğŸ“¦ Estado Atual do Projeto

### Estrutura de Arquivos
```
project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx âœ… (nÃ£o modificar)
â”‚   â”œâ”€â”€ page.tsx âœ… (home funcionando)
â”‚   â””â”€â”€ dashboard/
â”‚       â””â”€â”€ page.tsx âœ… (nova pÃ¡gina criada)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/ âœ… (shadcn configurado)
â”‚   â””â”€â”€ features/
â”‚       â””â”€â”€ auth/ âœ… (componentes de login)
â””â”€â”€ lib/
    â””â”€â”€ supabase/
        â””â”€â”€ client.ts âœ… (configurado e funcionando)
```

### APIs e FunÃ§Ãµes DisponÃ­veis

#### 1. AutenticaÃ§Ã£o
```typescript
// lib/auth.ts
export async function signIn(email: string, password: string) { ... }
export async function signOut() { ... }
export function useAuth() { ... } // Hook
```

#### 2. Banco de Dados
```typescript
// lib/supabase/queries.ts
export async function getCanais() { ... }
export async function getUser(id: string) { ... }
```

### Componentes ReutilizÃ¡veis

#### UI Base (shadcn)
- `Button` - Todos os estilos configurados
- `Card` - Com variantes
- `Input` - Com validaÃ§Ã£o
- `Dialog` - Para modais

#### Features
- `LoginForm` - FormulÃ¡rio completo
- `AuthGuard` - HOC para rotas protegidas

### VariÃ¡veis de Ambiente
```env
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
# Novas variÃ¡veis adicionadas:
NEXT_PUBLIC_APP_NAME=BetLink
```

### Estado Global
- Zustand configurado em `store/`
- Auth state funcionando
- Sem outros stores ainda

## âš ï¸ Cuidados e Avisos

### NÃ£o Modificar
1. `middleware.ts` - LÃ³gica de auth crÃ­tica
2. `app/layout.tsx` - Layout raiz
3. ConfiguraÃ§Ãµes do Supabase

### Testar Sempre
- [ ] Login/Logout continua funcionando
- [ ] NavegaÃ§Ã£o nÃ£o quebrou
- [ ] Console sem erros

### PossÃ­veis Conflitos
- Feature de pagamento vai usar `/app/api/`
- Telegram bot pode precisar de webhook em `/api/webhooks/`

## ğŸš€ Como ComeÃ§ar

1. **Instalar dependÃªncias** (se houver novas)
```bash
npm install
```

2. **Verificar variÃ¡veis de ambiente**
```bash
cp .env.example .env.local
# Preencher valores necessÃ¡rios
```

3. **Rodar projeto**
```bash
npm run dev
```

4. **Testar features anteriores**
```bash
npm run test:features
```

## ğŸ“ Notas Importantes

1. **PadrÃ£o de imports** estÃ¡ definido em `.eslintrc`
2. **Tipos TypeScript** gerados em `types/database.types.ts`
3. **Logs** devem seguir padrÃ£o `[Feature: Nome]`
4. **Novos componentes** em `/components/features/[sua-feature]/`

## ğŸ¯ Sua Feature

Com base no estado atual, sua feature pode:
- âœ… Usar autenticaÃ§Ã£o existente
- âœ… Criar novas pÃ¡ginas em `/app/`
- âœ… Reutilizar componentes UI
- âœ… Acessar Supabase configurado

Boa sorte! ğŸš€
```

---

## ğŸ› ï¸ Ferramentas de Suporte

### Script de Setup por Feature
```bash
#!/bin/bash
# scripts/new-feature.sh

FEATURE_NAME=$1
mkdir -p components/features/$FEATURE_NAME
mkdir -p tests/features
mkdir -p docs/learnings

echo "Feature $FEATURE_NAME criada!"
echo "- Componentes em: components/features/$FEATURE_NAME"
echo "- Testes em: tests/features/$FEATURE_NAME.spec.ts"
echo "- Docs em: docs/learnings/feature-$FEATURE_NAME.md"
```

### Template de Teste RÃ¡pido
```typescript
// tests/quick-test.ts
export async function quickTest(featureName: string) {
  console.log(`ğŸ§ª Teste rÃ¡pido: ${featureName}`);
  
  // 1. Build passou?
  await exec('npm run build');
  
  // 2. Lint passou?
  await exec('npm run lint');
  
  // 3. Types OK?
  await exec('npm run type-check');
  
  // 4. Testes passaram?
  await exec(`npm run test:feature ${featureName}`);
  
  console.log('âœ… Todos os testes rÃ¡pidos passaram!');
}
```

---

## ğŸ“Š MÃ©tricas de Sucesso

### Por Feature
- âœ… Teste humano passa na primeira tentativa: > 80%
- â±ï¸ Tempo de implementaÃ§Ã£o vs estimativa: < 1.5x
- ğŸ› Bugs em produÃ§Ã£o: 0
- ğŸ”„ Retrabalho necessÃ¡rio: < 20%

### Geral do Projeto
- ğŸ“ˆ Features entregues por sprint: 4-6
- ğŸ¯ Cobertura de testes: > 70%
- ğŸ“š DocumentaÃ§Ã£o completa: 100%
- ğŸ˜Š SatisfaÃ§Ã£o do desenvolvedor: Alta

---

## ğŸš€ BenefÃ­cios deste Workflow

1. **Previsibilidade**: Cada feature segue o mesmo processo
2. **Rastreabilidade**: Logs e documentaÃ§Ã£o em cada etapa
3. **Qualidade**: Testes em mÃºltiplas camadas
4. **Conhecimento**: Aprendizados documentados
5. **EficiÃªncia**: Handover elimina re-explicaÃ§Ãµes
6. **Escalabilidade**: Processo funciona para 10 ou 100 features